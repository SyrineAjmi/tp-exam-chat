<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mini Chat</title>
<style>
  body { font-family: sans-serif; max-width: 600px; margin: auto; padding: 20px; }
  #messages { border: 1px solid #ccc; height: 300px; overflow-y: auto; padding: 10px; margin-bottom: 10px; }
  #messages div { margin-bottom: 5px; }
</style>
</head>
<body>
<h2>Mini Chat</h2>
<input type="text" id="author" placeholder="Pseudo" /><br/><br/>
<div id="messages"></div>
<input type="text" id="content" placeholder="Message" />
<button onclick="sendMessage()">Envoyer</button>

<script>
// DÃ©tecter si on est en Docker Compose ou prod
//const DEFAULT_BACKEND = "http://tp-backend-chat:3000/api/messages";
//const PROD_BACKEND = "https://TON_BACKEND_PUBLIC.onrender.com/api/messages"; 
//const API_URL = window.location.hostname === "localhost" ? DEFAULT_BACKEND : PROD_BACKEND;
const API_URL = "http://localhost:3000/api/messages";
async function fetchMessages() {
  try {
    const res = await fetch(API_URL);
    const data = await res.json();
    const messagesDiv = document.getElementById('messages');
    messagesDiv.innerHTML = data.map(m => 
      `<div><b>${m.author}</b> [${new Date(m.time).toLocaleTimeString()}]: ${m.content}</div>`
    ).join('');
  } catch(e) {
    console.error("Erreur fetch messages:", e);
  }
}

async function sendMessage() {
  const author = document.getElementById('author').value.trim();
  const content = document.getElementById('content').value.trim();
  if (!author || !content) return alert("Pseudo et message requis");

  try {
    await fetch(API_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ author, content })
    });
    document.getElementById('content').value = '';
    fetchMessages();
  } catch(e) {
    console.error("Erreur send message:", e);
  }
}

// Refresh toutes les 3 secondes
setInterval(fetchMessages, 3000);
fetchMessages();
</script>
</body>
</html>
